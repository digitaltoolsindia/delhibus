<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Find Bus Route - Delhibus</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    body { font-family: sans-serif; padding: 1em; background: #f9f9f9; }
    h1 { text-align: center; color: #4CAF50; }
    .form { max-width: 500px; margin: auto; background: #fff; padding: 2em; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.05); }
    label, select, button { display: block; width: 100%; margin: 1em 0; font-size: 1em; }
    button { background: #4CAF50; color: white; padding: 0.8em; border: none; border-radius: 8px; cursor: pointer; }
    button:hover { background: #45a049; }
    #result { margin-top: 2em; text-align: center; font-size: 1.1em; }
  </style>
</head>
<body>
  <h1>ðŸšŒ Find Your Bus Route</h1>
  <div class="form">
    <label for="source">Starting Bus Stand</label>
    <select id="source"></select>

    <label for="destination">Destination Bus Stand</label>
    <select id="destination"></select>

    <button onclick="findRoute()">Find Route</button>
    <div id="result"></div>
  </div>

  <script src="js/routes.js"></script>
  <script>
    const sourceSelect = document.getElementById('source');
    const destSelect = document.getElementById('destination');
    const resultBox = document.getElementById('result');

    function populateDropdowns() {
      stops.forEach(stop => {
        const opt1 = new Option(stop.name, stop.name);
        const opt2 = new Option(stop.name, stop.name);
        sourceSelect.add(opt1);
        destSelect.add(opt2);
      });
    }

    function findNearest(lat, lon) {
      let minDist = Infinity;
      let nearest = null;
      for (const stop of stops) {
        const d = Math.sqrt(Math.pow(lat - stop.lat, 2) + Math.pow(lon - stop.lon, 2));
        if (d < minDist) {
          minDist = d;
          nearest = stop.name;
        }
      }
      return nearest;
    }

    function geolocateAndPreselect() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          const nearest = findNearest(pos.coords.latitude, pos.coords.longitude);
          sourceSelect.value = nearest;
        }, err => console.warn("Geolocation error", err));
      }
    }

    function findRoute() {
      const from = sourceSelect.value;
      const to = destSelect.value;
      const route = routes.find(r => r.from === from && r.to === to);
      if (route) {
        resultBox.innerHTML = `Available Buses: <strong>${route.buses.join(', ')}</strong>`;
      } else {
        resultBox.innerHTML = "No direct route found. Please try nearby stands.";
      }
    }

    populateDropdowns();
    geolocateAndPreselect();
  </script>
</body>
</html>
